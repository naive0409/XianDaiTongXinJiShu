# 第十五次课

# 上次课
路由选择算法
- 直接转发，最后一次转发肯定是
- 间接转发：查路由表
- 默认路由（以防意外和缩减表项），特定主机路由（管理维护）

# 6
## 6.2 路由器工作原理和硬件结构
### 6.2.2 路由选择算法及路由协议

**选路算法**
子网掩码在路由器中

1. 计算目的网络地址
2. 是否为直接路由？是则直接转发
3. 否，那是否匹配特定主机路由？是则特定主机路由
4. 否，那是否为路由表中的项？是则按表确定下一跳地址
5. 否，则按默认路由转发，没有默认路由则转发失败

Internet中使用**动态自适应、分布式、分层次**的路由协议

- 内部网关协议
  - RIP
  - OSPF
- 外部网关协议
  - BGP 4

最短路由
- 跳数多少：HOP逐跳转发
- 物理距离长短
- 时延

常用主要两种：
- 距离矢量路由算法
  - RIP
  - BGP
- 链路状态路由算法
  - OSPF

**RIP**
最早出现，使用最长
路由器内部维持一个距离适量表
周期性地和相邻路由器交换路由表信息HeartBeat
不能超过16跳：难以适应大型网络和剧烈变化的网络
p88更新过程

**OSPF**
每个节点都知道全网的拓扑结构
事件驱动更新，需要更新时才更新
广播给全网
对于规模大的网络，分为不同区域，每个区域的边界路由器ABR构成骨干区域跨区通信

### 6.2.3 路由器硬件结构
p92
一个物理接口=线卡板+接口板
第一代p96
第二代p98：多个CPU，分布式缓存
第三代p100

**ip包处理转发p105，106**
输入端口拿到ip包，根据目的地址查询路由表确定输出端口。查看ttl，优先级等。
通知主控分配共享缓存的地址，输入端口将包存在地址中
主控通知输出端口，从缓存指定位置读取ip包，发送出去

1. IP包到达路由器输入端口，提取所需首部信息。
2. 根据目的地址，查询路由表，确定该IP包的输出。同时完成转发准备工作，例如对IP包首部L字段的修改，首部校验和的重新计算等。
3. 转发引擎检查IP包首部的网络层相关信息以及传等高层信息，获取QoS和接入控制策略等，以IP包的优先级进行分类。
4. 转发引擎为该IP包分配优先级。此外，根据拥塞策略和安全策略，也有可能丢弃该IP包。
5. 转发引擎通知系统主控CPU有IP包到达。
6. 主控CPU为该IP包预留一个缓存空间。
7. 该IP包被存入共享缓存的指定位置，主控CPU通应的输出端口。如果是多播流，则通知对应的输出端口。
8. 输出端口需要根据预先指定的调度策略和该IP包先级，获取该IP包。
9. 当IP包到达输出端口，通知主控CPU。共享缓存对应空间被释放，供新的数据包使用。


### 6.2.4 多协议标记交换（MPLS）技术
（不考）

## 6.2 总结
路由器如何转发ip包
RIP，OSPF优缺点
路由器如何分类，各自代表协议

# 第七章 软交换和IMS技术

## 7.1 软交换网络技术
### 7.1.1 IP电话网技术
核心：IP电话网关
与传统电话网比较：
- 都是分级网络架构
- 编号寻址差别很大
- 信令种类更复杂

### 7.1.2 软交换
- 开放网络架构
- 业务驱动
- 统一IP协议的分组网络

**软交换**
- 狭义：软交换设备
- 广义：体系结构
