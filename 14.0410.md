# 第十四次课

# 上次课

传输层：只有终端有
TCP可靠传输：三次握手，差错，流量，拥塞控制
UDP：传输层无连接，上层负责可靠性

端口：本地有意义

UDP伪首部
TCP 总结p45，首部结构p48
全双工：窗口，确认序号
三次握手：捎带确认，四次变为三次

差错控制：字节编号，ack=期望收到的下一个
重传机制：时间驱动更新RTTs，数据驱动多个重复ack
流量控制：动态自适应滑动窗口

# 6
## 6.1
### 6.1.4 传输层协议

**拥塞控制**
p63
窗口：拥塞控制的和流量控制的

慢启动，超过ssthresh后改为线性增加（拥塞避免）
超时，重新从1开始慢启动
ssthresh：设为超时发生时窗口大小的一半

### 6.1.5 ipv6
128bit
冒号16进制

v4向v6演进：
- 双协议栈

- 隧道技术
v6包进入v4网络时，封装为v4包，包离开v4网络后拆开

## 6.1 小结
不同层次工作的设备
tcp/ip参考模型
ip地址
地址转换
ip包首部
传输层主要协议
重传 流量 拥塞 三次握手
慢启动，拥塞避免
v4-v6演进

## 6.2 路由器工作原理和硬件结构

### 6.2.1 路由器基本工作过程
路由器工作在网络层

**A-R-B**

上层的数据->加首部(AB的ip和端口（服务器有熟知的）)生成报文->
加首部(A的ip，B的ip(DNS)，**不变，网络层的范围是端到端**)生成IP包->
加首部(A和路由器R左边的MAC，**一直在变，链路层的范围是同一个网络的邻居节点**)生成数据帧->
物理层（**变，上层数据变化和不同的调制编码技术**）->
R左侧网卡物理层接收->链路层解除帧封装，看目的MAC地址是不是自己->
是，链路层往上交->网络层查看目的ip:是B的，查路由表->
对应接口（右侧）链路层重新封装数据帧(R右侧的mac，B的mac(**ARP**))->
B物理、链路、网络层看是否发给自己的，是则向上交。传输层交给对应端口、应用层呈现

**路由选择算法**
- 直接转发
- 间接转发
- 默认路由，特定主机路由
