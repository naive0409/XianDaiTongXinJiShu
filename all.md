# 第三次课

## 人的听觉特性
### 对数关系
### 频响特性

不同频率的声音感受强度不同
- 频率范围：20-20kHz
- 最敏感：3-5kHz

### 掩蔽效应
#### 时域：
**强的掩盖弱的**
	- 前向
	- 后向
#### 频域
![](https://s3.bmp.ovh/imgs/2023/02/27/613d1a7fd017ab22.png)

## 音频信号特性
- 频谱
- 强度，动态范围

## 图像扫描
满足人眼对于
- 闪烁感
- 跳跃感

的要求

## 彩色电视系统

![](https://s3.bmp.ovh/imgs/2023/02/27/c00795431e7be4af.png)
彩色电视系统是根据人眼彩色视觉与三基色原理设计和工作的。

## 显示器色彩
- 24位：足够人眼识别的颜色数量
- 32位：24+8(**Alpha透明通道**)

## 广播制式：色彩系统 + 广播系统

### 色彩系统
- NTSC：接收机简单，和其他制式相容，NeverTheSameColor，美洲
		- 29.97 = 30 / 1.001
- PAL：稳定泛用，亚洲，大洋洲，非洲，欧洲
- SECAM：俄罗斯，法国，西非

### 广播系统
- D/K

## 彩色与黑白电视机不兼容，怎么办？

RGB改成YUV

### Y 纯亮度

### UV 两个色差
- U = K_1 (B-Y)
- V = K_2 (R-Y)

### 人眼对亮度更敏感，可以丢掉一些UV

都是线性运算：
- 黑白电视机只用Y
- 彩色则解算


## 冗余：继续压缩
### 主观冗余
- **人眼不注意的**
- 色度亚采样
- 杨·凡·艾克：镜子里的可以不画
### 空间冗余
- DCT
- **相邻像素的相关性**
- 千里江山图：山顶的蓝色比较相似，可以传差值
### 统计冗余
- 熵编码
- （0，0，0，0，0）-> （0，5）

## 视频信息冗余

### 时间冗余
- **相邻两帧几乎不变**
- 新闻：很大
- 体育：很小

### 信息熵冗余（统计冗余）
### 结构冗余
- **广义上还是空间冗余**
- 纹理
- pattern
### 视觉冗余
- **广义上是主观冗余**
- 水平方向分辨率更好
- 快速运动的物体分辨率下降
### 知识冗余
- 人脸具有固定的结构
- **图像的结构可以从先验知识获得**
- MPEG-7

## 视频压缩编码

- 主流：混合编码器
	- 分割成小块
- 神经网络编码

## 电视传输方式

### 卫星
### 逐渐融合化->IPTV

## 数据通信

### 宽带IP

### VPN

## 5G

### 三大主要应用场景
	p36
- 增强型移动宽带业务
- 超高可靠与低延迟
- 大规模机器类通信


### 五种业务需求
	p37
- 超高速
- 超高用户密度
- 超高速移动
- 低时延高可靠
- 海量终端连接


# 第四次课

前面是业务部分
接下来几周都是**交换和路由**，4-7章

4. 基础知识，重中之重
   - 成对出现的概念
   - 理清逻辑
5. 电路，分组
6. IP
7. 软交换，IMS


# 交换和路由

垂直分层的中间一层

# 第四章 交换与路由技术基础


## 通信网络提供的主要业务
- 基本的话音，数据，多媒体业务
- 上面三个要按顺序：用户需求发展，通信网发展的动力和目标

## 不同通信网络区分
采用**不同交换技术**的**节点交换设备**

## 本章重点
p3
- 典型网络的分类、技术要素
- 典型网络使用的节点交换技术
- 节点交换系统的基本功能
- 无连接与面向连接

# 4.1 网络分类及交换基本功能
## 典型网络分类
- PSTN固定电话
- CHINAPAC分组交换网
  - 上个世纪
- CHINAFRM
- CHINADDN
  - 以前
  - 银行，网吧，证券：网速要求高又不差钱
  - 电路交换
- CHINAFAX传真存储转发网
  - 和有线电话号重合
- N-ISDN
- B-ISDN
  - 愿望：综合
  - 没大规模应用：专利斗争，被互联网取代
- IN智能网
  - 语音信箱
  - 缩位拨号
  - 热线电话
  - 全国统一电话
  - 根上和PSTN一致
- 移动通信网 1-6G
  - 2G GSM是电路交换
- No.7信令网
  - 为了网络正常运行
  - 逻辑上独立
  - 实际中叠加在网络上
- TMN
  - 鉴权
  - 运营商收费
  - 认证
- 数字同步网
  - 对表，每个节点时间同步
  - 逻辑上独立
  - 实际中叠加在网络上

p8 专业术语

![](https://s3.bmp.ovh/imgs/2023/03/05/2c9ef485bf7d8e19.png)

![](https://s3.bmp.ovh/imgs/2023/03/05/fd10c4c6a58ebadc.png)

## 基本技术要素

### 网络结构
节点之间的联系方式
- 网状网
  - 效率高
  - 管理复杂、成本高
- 分级网
  - 管理简单、成本低
  - 效率低
- 大概分成两种：传统通信网、互联网
- 各种通信网均为分级网，同级中也使用网状网
- 计算机**局域网**中通常是星形、总线形、环形、树形等。
  - 多用户怎么办？

### 编号计划
- 节点都有编号来**识别身份**
  - 基本方式：等长，不等长
    - ipv4：等长
    - 电话号码：等长和不等长结合
- **便于寻址**
  - 捡到一张饭卡，如何直接找到本人？学号编号是有规律的
    - 入学年份：师姐？师妹？辅导员？
    - 学院：找线人
    - 小班
  - 有线的、设备固定：按片划分
    - ip
    - 电话
    - 分级也是按片的，结合起来就能寻址

### 计费方式
传统电信网：服务质量运营商要管，不好就投诉
- 其实2G打电话最好：电路交换

internet：免费
- 网费是接入费用
- 免费就不能保证资源质量：损失没人管
- 不能可信可控可管

## 交换的引入
1. 两个用户，**点到点**直连即可
2. 用户增加，**全互联网**
3. 继续增加，引入一个交换设备，临时地构建通道
4. 继续增加，一个交换机能力有限，采用多级交换机互联，**通信网**

## 交换的基本功能

**（对于一个交换节点，）在任意入线和任意出线之间（根据需要）建立连接将入线上的信息分发到（对应的）出线上。**

# 4.2 交换基本原理
## 4.2.1   交换节点中传送的信号
信号不一样->处理技术不一样（两类交换技术）->不同的通信网络

两种信号：
1. 同步时分复用信号
2. 统计时分复用信号

都是**时分复用信号**：采用时间分割的方法，将一条高速数字信道分成若干低速数字信道。

### 同步时分复用信号
- 一秒平分为若干**帧**（时间单元），一帧平分为若干**时隙**。
- 不同帧里**相同**的时隙成为一个子信道（**位置化信道**）。
- 相同用户的信息在信道上**周期性**出现。
- 固定分配资源，独占。所以**单个用户服务质量有保证**
- 时隙不能无限分，有上限->要有**接入控制，准入制度**
- 若语音通话，到了你的时隙，如果没有话要说那么就只能传输噪声，所以**传输速率是恒定的**
- 然而这段时间不能省略，别人也不能用，所以**资源的利用率不高**
- 交换设备如何区分不同用户的信号？按时间和前导码就行，处理效率很高（**位置化信道**）
- PCM：典型的同步时分复用信号：`8bit * 8k/s = 64kbit/s`

### 统计时分复用信号
- 需要传送的信息分成小块，称为分组，每个分组之前附加标志码，标志要去哪个输出端（**路由标记**）
- **没有帧**了，同一路信号可以占用不同的时间位置，**非周期性**
- 各路信号由标记加以区分（**标志化信道**）
- 没有准入了，进入信道要竞争

# 第五次课

上周：
交换

ip网：6
核心网：7

业务：语音数据多媒体
背景，环境

区分通信网络

### 统计时分复用
- 用户数不断增加，许多人没资源
- 数据业务增加，数据业务的突发性

分组：首部+数据
首部
- 属于哪次通信，从哪个发端发出，要到哪个收端去
- 开销增加了
- 靠首部去分辨来自哪个用户，**标志化信道**
  - 如何做到？硬件（物理层）获得电平交给上一层
  - 比同步复杂，时延也长

分组的大小？未必相同（ATM和ip）
收到了用户的信息，不能判断下次相同用户出现的时间，**非周期性**
用户的传输速率可变，要去计算**统计**:一段事件中传了多少数据
**资源利用率高**
**单个用户性能有所下降**


## 4.2.2 电路交换和分组交换

### 电路交换
基于同步时分复用

- 连接为**物理连接**
  - 具有排他性
- 通信前建立连接，通信后拆除，通信期间连接始终保持，无论是否有信息传送
  - 建立连接：找到一条从发端到接收端通信的路径，到达后原路返回。对应时隙分配
  - 拆除：收端发给发端
- 一般用于电话交换
- **优点**：**实时性**好，只要允许建立连接就能保证通信质量
- **缺点**：**灵活性**差，整体资源利用率低
- 典型：
  - 有线电话PSTN
  - DDN网
  - 移动通信网2G：GSM

为语音业务量身打造，语音业务与数据业务有很大不同，不能很好地支撑数据业务->统计时分复用和分组交换
- 通信对象不同：人和人/人和机器，机器和机器，复杂协议
- 可靠性要求：1E-3/1E-8以下
- 通信平均时长和通信建立请求响应：5min,建立15s/<50s,建立1.5s
- 业务量：双方基本一致/不对等（上下行不对称）
- 以上的对比基本是上世纪的情况

### 分组交换
基于统计时分复用
- 分成若干分组，每个分组加控制信息，**采用存储转发方式**：
物理层完整地接收下来先**存储**，上一层来读取，然后**转发**。丢包的原因之一
- 可以不建立连接，也可以建立，连接为逻辑连接（虚连接）
  - 逻辑连接
    不会给某个用户提前预留
    不会固定分配给用户
    保证不了通信质量
  - 无连接
    包各自独立
    ip
    因特网/互联网
  - 面向连接
    ATM
- 也可以用于分组话音业务
- **优点**：**灵活性**好，资源利用率高
- **缺点**：时延，**实时性**，通信质量

**分组交换中，每发一个分组，接收方必须要回应确认**

### 快速电路交换
### 快读分组交换——帧中继
简化X.25协议，提升传输速率
基于光纤的发明

### 异步传送模式ATM
综合电路和分组交换的优势
基本特点
1. 本质上基于统计时分复用
2. 面向连接
3. 固定长度信元(cell遇到cell开始就知道控制信息在哪里，以及什么时候结束)
4. QoS保证

### 光交换
节点不需要光电/电光转换过程
好处：
- 减少光电变换的损伤信号质量
- 不受电子器件速度的限制

### 出现顺序
控制复杂度：简单->复杂
1电路->2快速电路->4ATM<-3快速分组<-2分组

## 4.2.3 开放系统互连参考模型与节点交换技术

### OSI模型
7层
- 7 应用
- 6 表示
- 5 会晤
- 4 传送
- 3 网络
- 2 数据链路
- 1 物理

分层网络的概念
为什么要分层？通信太复杂，分成若干子任务
每层有各自功能

# 第六次课

上次课：

两种信号

两种交换技术

## 4.2.3 开放系统互连参考模型与节点交换技术
### OSI模型

p66

- 7 应用：最靠近用户
  - 功能：
    - 确定**进程**之间通信的性质以满足用户的需要
    - 负责用户信息地语义表示，并在两个通信者之间进行语义匹配

- 6 表示
- 5 会晤/会话
  - 做一些语义的表达

- 4 传输
  - 范围：发端进程到接收端某个**进程**
  - 第四层及以上只在用户的终端里有
  - 功能：
    - **弥补**具有低3层功能的各种通信网的欠缺和差别，保证数据传输的质量满足高3层的要求
    - 根据通信子网的特性，最佳地利用网络资源，并且以可靠和经济的方式为两个**端系统（源站和目的站）的会话层**之间建立一条传输连接以**透明**地传送报文
  - 数据单元：**报文**

- 3 网络
每个端有多个进程通信（听歌+看网页+...），光端到端还不够
  - 范围：发端节点到接收端节点，**端到端**，可以**异构**网络间传输（**跨网**）
  - 功能：
    - **寻址**：选择合适的**路由**和**交换节点**，使发送站的传输层所传下的分组能够正确无误地按照地址找到目的站并交付给目的站的传输层
    - **拥塞控制**
  - 数据单元：**分组/包**
  - ip

- 2 数据链路**Link**
  - 范围：**同构**的网络**邻居**节点之间，**局域网**
  - 功能：
    - 在两个**相邻**节点之间的线路上**无差错**地传送以**帧**为单位的数据
    - 建立、维持、释放数据链路的连接
  - 数据单元：**数据帧**，除了数据还有必要的控制信息
    - 和同步时分复用的帧不一样
    - 同步信息
    - 地址信息
    - 差错控制信息
    - 流量控制信息
  - MAC,媒体接入控制地址

- 1 物理：地基
  - 范围：点到点
  - 功能：
    - **比特流**的**透明**（不管01的含义，不做修改）传输
    - 电气特性，管脚

为什么要分层？
- 一次通信太复杂，分成若干相对独立的简单子任务
- 多点并进发展

底层向上提供服务，上层享受服务


### OSI中的信息传递过程p31

发端：用户有消息传输，给第七层，逐层向下处理

第七层添加首部控制信息（这些信息只有收方的第七层才能看懂），又作为第六层的数据部分

……

收端：往上，到第七层用一定方式展现

拆信封的过程

![](https://s3.bmp.ovh/imgs/2023/03/09/1baeb0f39a064d61.png)

**p32必考**

刚才讲的交换在七层模型中如何

以太网
- 最广泛的有线局域网技术，和wifi是两套协议
- 第二层比较复杂：同一时刻只能一个人用公共资源，如何协调？

![](https://s3.bmp.ovh/imgs/2023/03/09/2f00350204f829bf.png)

### X.25与帧中继比较

## 4.2.4 无连接和面向连接

### 无连接和面向连接
networking mode：组网角度

无连接：
- 无需事先建立连接（通路）
- 建立连接的开销
- 乱序传输，重复
- 效率高
- 速度快
- 小数据量传输的场景

面向连接：通信前建立连接（通路）,通信后拆除连接,通信期间,不管是否有信息传送，连接始终保持
- 可靠性好
- 效率低
- 大量数据传输，按顺序传输的场景

### 物理连接和逻辑连接
物理连接
- 基于同步~
- 指定路由中任意两个节点间的物理通路确定，即一个通路就是一个**选定的时隙**。

- **固定分配资源**
- 所有物理连接都对应同步时分复用信号，反过来也对
- 所有物理连接都对应电路交换，反过来也对

逻辑连接
- 基于统计~
- 指定路由中任意两个节点间的通路**不是指定的时隙**，而是逻辑通路，即一个通路就是一个选定的逻辑信道号。

- **不固定分配**
- 所有逻辑连接都基于统计时分复用信号，反之不对
- 所有逻辑连接对应分组交换，反之不对
- ip网无连接


### 半永久和交换式连接

半永久连接

交换式连接

### PVC & SVC：上边两个的虚连接

PVC

SVC

## 4.2的总结

## 4.3 交换系统的基本结构与功能描述

一个节点的几方面功能
- 连接：入线和出线的连接
- 接口：光电转换，电平转换
- 信令/协议：识别信令
- 控制

### 4.3.1连接功能

$M \times N$

连接集合和函数

$T = \set{0,1,...,M-1}$
$R = \set{0,1,...,N-1}$

一条入线上的消息，可能从一个出线，也可能是多个出线出去


# 第七次课

上次课：
4.2结束，osi7层
4.3开头

### 4.3.2 连接功能的基本技术
#### 拓扑结构

#### 控制方式

#### 阻塞特性
分类

- 有阻塞
  - 内部阻塞：设备硬件的性能有关
- 无阻塞
  - 严格
  - 可重排
  - 广义

阻塞率
- 电路
  - 也有存储
- 分组
  - ATM

#### 故障防卫

### 4.3.3 接口功能

UNI用户线
NNI中继线

2B+D

### 4.3.4 信令/协议功能
p65

- 随路信令
  信令通过话路传送
- 共路信令
  信令的传送与话路分开
  （中国）7号信令

协议
- 语法
- 语义
- 同步

### 4.3.5 控制功能

思考题6，9，10（不是作业）
第四章结束

第四章开头还有两个问题：
- 不同的通信网络如何区分？
采用**不同交换技术**的**节点交换设备**
- 典型网络分类

# 第五章

## 5.1 电路交换基本原理



## 5.2 分组交换基本原理


# 第八次课

这次课很重要

## 5.1 电路交换基本原理

演进过程
- 人工交换系统
- 自动交换系统
  - 模拟交换系统
  - 数字交换系统

### 基本要求

- 话路子系统
- 控制子系统

### 用户电路：七项基本功能，BORSCHT

- 馈电Battery Feeding
- 过压保护Over Voltage
- 振铃Ringing
- 监视Supervision
  - 发现哪个终端有通话请求，扫描电平
- 编译码和滤波CODEC & Filters
  - ADC
- 混合电路（二、四线转换）Hybrid Circuit
- 测试Test

时分与空分功能

### 时间（T）接线器：交换网络的基本单元
不工作看不出来工作方式

#### 输出控制方式
**顺序写入，控制读出**

话音存储器(SM)顺序存储信号内容，同时其**输入时隙的编号**存储在**控制**存储器(CM)地址为**输出时隙编号**的单元中

#### 要求增加会如何？
8bit8用户->16bit32用户：
话音存储器展宽为16bit，32项
控制存储器展宽为5bit(=$\log_232$)，32项

#### 输入控制方式
**控制写入，顺序读出**

控制存储器顺序（即按输入时隙编号）存储**输出时隙编号**，同时其信号内容存储在**话音**存储器中编号为**输出时隙编号**的单元中

#### 什么时候确定的控制存储器？

电路交换，同步时分复用，建立物理连接时就固定了。**固定分配资源**


### 空间（S）接线器
不工作也能看出来工作方式

#### 输入控制
控制线与**入线**平行

CM：列数为入线数量，行数为时隙数，存储单元中为出线号

#### 要求增加会如何
4入$\times$4 出改为8入 $\times$16出(?):
控制线改为8条
CM改为8条入线，依然8个时隙，每个存储单元改为5($=\log_232$)bit

#### 输出控制
控制线与**出线**平行

CM：列数为出线数量，行数为时隙数，存储单元中为入线号


#### 实际中，只有一种方式常用，是哪种？

输出控制。避免内部阻塞


### 经典结构：TST交换网络

内部时隙

A用户
1. T,0线(HW0)：2->7时隙（内部）；
2. S,0->31线,依然是7时隙；
3. T,31线(HW31)：7->511时隙。

B用户
1. T,31线：511->263时隙（内部）；
2. S,31->0线，依然是263时隙；
3. T,0线：263->2时隙。

A和B是一次通话的两条通路
- 线号和内部时隙都不能随便分配
- 263 - 7 = 256 = 512/2，差半帧，反向法


### 时延
并不是没有，但是可控

# 第九次课
## 上次课
继续电路交换：同步时分复用
数字程控交换机
话路子系统
用户电路七项功能
T时分，S空分
TST交换网络

# 5.1 电路交换基本原理

## 5.1.3 电路交换系统软件功能结构
- 操作系统
- 呼叫处理
- 维护管理

两个用户连接到同一台交换机：
- 程控交换机周期性扫描
1. 主叫用户摘机，交换机检测到电平变化，检查主叫的状态和权限
2. 送**拨号音**
3. 主叫用户拨号，交换机收到第一位后停止送拨号音，开始分析号码，找到被叫用户
4. 拨完号，检查被叫用户是否占用
   1. 空闲，向被叫用户送**振铃**，向主叫用户送**回铃音**
   2. 正在接听，给主叫用户送**忙音**
5. 交换机扫描到被叫用户摘机
6. 消息传输
7. 主叫与被叫都可以挂断，以叉簧压下为准。
8. 若主叫挂机，交换机扫描到电平变化，向另一方送**催挂音**
9. 接着被叫挂机
10. 拆除连接，释放资源

### 呼叫处理程序

- 用户扫描
- 信令扫描
- 数字分析
- 路由选择
- 通路选择
  - 交换节点内部
- 输出驱动

状态的转移：
- 输入处理
- 内部处理
- 输出处理

## 5.1.4 性能指标 & 5.1.5 电话网技术
p29

## 5.1.6 智能网技术
智能网将网络的交换功能与控制功能分离，便于业务的开发和修改

p37
- 业务交换点SSP
  - 呼叫处理和业务交换功能。接受SCP发来的控制命令。一般以原有的数字程控交换机为基础，配以软硬件和7号信令网的接口。
- 业务控制点SCP
  - 是智能网的核心功能部件，存储用户数据和业务逻辑。IN中的所有业务控制功能都集中在SCP中。
- STP
- SCE
- SMS

## 5.1 总结
p39

# 5.2 分组交换基本原理

## 5.2.1

# 第十次课
## 上次课
智能网：还是围绕语音业务
将交换功能和控制功能分离，便于业务的开发和修改
SSP，SCP
800业务：被叫付费，全国统一。号码没有寻址功能
SSP识别到800，通过信令查询SCP的数据库，返回号码后再寻址

## 5.2 分组交换
### 5.2.1

分组传输方式
- 数据报
- 虚电路

对比p53

### 5.2.2 分组交换技术
路由选择

分组进入交换节点，节点中央处理单元(CPU)对分组进行测试，包括对分组网络层目的地址的检验，在这个基础上，分组被安排在正确的出线，并进入相应的队列等待发送。由节点选择正确的出线的过程被称做**路由选择**功能。

延迟的三个因素
- CPU以及出链路队列中的排队时间：网络状态，负载均衡
- CPU处理时间
- 分组传输时间：比特流注入线路需要时间，分组长度/传输速率

路由选择的两种方式
- 表控路由
- 无表路由

路由表的确定方法：**路由算法**
- 路由选择程序
  - 静态（非自适应）和动态（自适应）
  - 集中式和分布式
- 最短路由算法：Dijkstra算法

资源分配
- 流量控制
  - 接收端资源不够用
  - 接收端监控网络，明确发消息给发送端
- 拥塞控制
  - 网络中资源不够用
  - 用户自己模糊地监测网络情况
    - 由于缺少缓冲空间而被丢弃分组的百分比
    - 平均队列长度
    - 超时重传分组数
    - 平均分组时延
- 最终都是发送端暂缓了数据


### 5.2.3 ATM技术（异步传送模式）
- 基于统计时分复用
- 面向连接
- 固定长度信元
- QoS保证

p58很重要

- 本质是分组传送模式
  - 统计时分复用
  - 端到端纠错
- 融合电路传送模式
  - 固定长度信元
  - 面向连接
  - 硬件交换网络

#### ATM信元结构

格式和编码
- UNI用户网接口UserNetworkInterface
  - 跟用户相连的线上
  - 多了一个GFC,GeneralFlowControl,流量控制
- NNI网络节点接口

两级连接，两级交换p62
- VPI
- VCI
相当于连接编号，不是目的端和源端地址
- VP：只改变VPI
- VC：VPI，VCI都变化

相当于OSI低两层

#### 交换原理
名称：ATM交换机
信头、链路翻译表
- 建立连接时就确定
输出前更改信头：本地存储

#### VPI和VCI
Virtual Pass
Virtual Channel
适应骨干网

# 第十一次课

# 5.2 分组交换
## 5.2.3 ATM技术（异步传送模式）

### 交换连接功能

- 空分交换
- 时分交换
- 信元头交换

交换节点的接续功能：
- 路由选择：传输线之间的交换
- VPI/VCI交换：信头翻译
- 缓冲区解决输出逻辑信道冲突：排队

ATM交换结构：BANYAN网络

## 5.2.4 以太网技术
- 最广泛的（有线）局域网
- 双绞线、光纤
- 星型拓扑
- 交换式以太网

### 介质访问控制方式

谁有权使用公共传输媒体
**CSMA/CD:带有冲突检测的载波监听多路访问（多址接入）**
- 媒体空闲则传输
- 媒体忙则一直监听直到空闲，马上传输
- 传输时检测到冲突，立即取消传输
- 冲突后随机等待一段时间，然后再试图传输

### 系统组成
网卡，集线器，双绞线

## 5.2 总结
1.  分组的两种传输方式是什么？虚电路，数据报
2.  简述ATM技术的基本特点。本质分组，综合电路优点
3.  举例说明ATM交换基本原理。查询信头链路翻译表
4.  以太网的介质访问控制方式是什么？CSMA/CD


# 第六章 IP网技术
## 6.1 ip网的体系结构和协议地址
### 6.1.1 互联网的概念

网络互联设备p7

带宽，时延，时延带宽积
- 传播时延
- 发送时延
- 排队时延
- 处理时延

- 传播时延带宽积
- 往返时延带宽积

### 6.1.2 互联网的体系结构
p16
五层模型
- 物理
- 数据链路
- IP层
  - 转发和路由
  - 路由器
- TCP/UDP（传输层）
  - 面向连接，可靠
  - 无连接，不可靠
- 应用层

### 6.1.3 网络层协议与IP协议地址
IP 地址的分配是在统一的管理下进行（NIC）
p19 作用：IP 地址在网络层上屏蔽了异种网络之间物理地址等特性的差异，利于网间通信的实现。
底层完不成的上层来负责

#### 子网

# 第十二次课

# 上次内容

6.1.1
互联设备
集线器、交换机、路由器、网关

互联网：通过TCP/IP 实现的网际互连隐藏了网络的细节（包括底层网络技术、拓扑结构等），提供通用的一致性的网络服务，互联网或Internet 在逻辑上是一个统一的、整体的虚拟网络，用户完全可将其看作是一个单一的网络。

性能指标
- 带宽
- 时延，多个成分，也与层有关

6.1.2 五层模型

IP 地址在网络层上屏蔽了异种网络之间物理地址等特性的差异，利于网间通信的实现。


# 6
## 6.1
### 6.1.3 网络层协议与IP协议地址
IP:32bit 主要为ABC三类p21
- A:0xxxxxxx|(0-127)24位主机号
- B:10xxxxxx|xxxxxxxx|(128-191)16位主机号
- C:110xxxxx|xxxxxxxx|(192-223)xxxxxxxx|8位主机号

点分十进制表示法

#### 子网，掩码

手里只有C类地址，主机号数量不够用；将来的设备会越来越多->**子网划分**

取高位的主机位**跟网络号相连的**，划分子网，形成新的网络号，剩下的部分作为主机号。

但是再拿到一个新的IP地址，就不知道实际的网络号是多少->**掩码**
实际网络号都对应1，主机号都对应0.

掩码和ip地址相与即得网络号。

表示法：点分十进制ip地址后给出掩码中1的位数
```
189.23.0.0/16
```

> 例子：135.41.0.0/16 划分为20个能容纳200台主机的网络
> 10000111|00101001|*
>
> 200 < 256 = 2^8
> 20 < 32 = 2^5
>
> 考虑多分网络号：掩码11111111|11111111|11111111|00000000
>
> 第一个子网
> 135.41.0.1/24 ~ 135.41.0.200/24
> 第二十个子网
> 135.41.19.1/24 ~ 135.41.19.200/24
>
> 考虑多分主机号：掩码11111111|11111111|11111000|00000000

> 例子：每个子网中主机数不同

#### 地址转换

- ip-主机名
  - 小型：HOSTS
  - 大型：DNS
- ip-（同一个网络中的）主机物理地址
  - ip->物理：ARP(Address Resolution Protocol)
  - 物理->ip：RARP

#### ip包首部
p29
最小的ip包：只有固定首部，20字节
- V版本,4bit:ipv4/6
- HL首部长度,4bit:0101(5倍于4字节=20字节)
- TOS服务类型,8bit
- TLEN总长度,16bit:整个包实际总长
- Identification标识符16bit,Flag标志3bit,Offset分片偏移量13bit:编号
- TTL生存时间,8bit
  - 丢包：TTL归零
- Protocol协议,8bit:UDP,TCP
- Checksum首部校验和,16bit
- 源ip
- 目的ip

# 第十三次课

# 上次课
ip：网络号+主机号
路由器看网络号，到目的后再看主机号
子网：ip不够用，早期A类地址浪费。高位主机号分为网络号，掩码
划分子网：从主机数或网络数入手
地址转换：HOSTS，DNS
ARP，RARP，掌握中文名称
IP包结构

# 6
## 6.1
### 6.1.3 网络层协议与IP协议地址

ip包里没有掩码，怎么办？
总长度：20字节 ~ $2^{16}=65535$字节。受MTU的限制，发送的比这个大怎么办？
ip包分片，用到标识符ID(16bits)，标志FLAG(3bits)，分片偏移量FO(13bits)
每个分片加上片头，FO为$0，\frac{MTU-20}{8},\frac{2MTU-20}{8}$,...
MF最后一个片为0，其他为1，LEN=MTU，例子p33
丢包：路由器不会分片，重组失败

### 6.1.4 传输层协议

只有用户终端里有
报文
端口号：只在终端本地有意义

#### UDP:User Datagram Protocol用户数据报协议
首部8字节p40
- 源端口
- 目的端口
- 长度
- 校验和
- 伪首部（算校验和用）

#### TCP:Transimission Control Protocol传输控制协议
传输层面向连接
可靠交付：差错控制，流量控制，拥塞控制
全双工
面向字节流

socket

**socket复用**：一个主机的某个TCPsocket可以被多个连接共享。本地的应用进程可是同时与多个目的主机的进程分别通信，不会混淆

首部20字节
- 源端口
- 目的端口
- 序号
- **确认序号**
- 首部长
- 保留字
- 控制位
  - UGR
  - ACK
  - PSH
  - RST
  - SYN
  - FIN
- **窗口**
- 校验和
  - 计算时考虑伪首部
- 紧急

**三次握手**
有稍待确认，四步变为三步
1. SYN=1,seq=x
2. SYN=1,ACK=1,seq=y,ack=x+1(希望下一个收到x+1)
3. ACk=1,seq=x+1,ack=y+1

**差错控制**
接收端返回最新的ack
若5未到，67已到，则会多次发ack=5

**重传机制**
- 时间驱动
  - 发送端一定时间没有收到ack则认为报文已丢失
  - 往返时延RTT
  - 更新RTT=(1-$\alpha$)更新前RTT+$\alpha$此次获得的RTT
- 数据驱动
  - 发送端连续收到重复的ack，认为报文已丢失

**流量控制**p58
接收端资源不够用
**端到端动态自适应滑动窗口**

**拥塞控制**
多个窗口：发送端实际发送的窗口受两方控制：接收端流量控制和发送端拥塞控制，取小的那一个
- 慢启动
- 拥塞避免
- 快速重传
- 快速回复


# 第十四次课

# 上次课

传输层：只有终端有
TCP可靠传输：三次握手，差错，流量，拥塞控制
UDP：传输层无连接，上层负责可靠性

端口：本地有意义

UDP伪首部
TCP 总结p45，首部结构p48
全双工：窗口，确认序号
三次握手：捎带确认，四次变为三次

差错控制：字节编号，ack=期望收到的下一个
重传机制：时间驱动更新RTTs，数据驱动多个重复ack
流量控制：动态自适应滑动窗口

# 6
## 6.1
### 6.1.4 传输层协议

**拥塞控制**
p63
窗口：拥塞控制的和流量控制的

慢启动，超过ssthresh后改为线性增加（拥塞避免）
超时，重新从1开始慢启动
ssthresh：设为超时发生时窗口大小的一半

### 6.1.5 ipv6
128bit
冒号16进制

v4向v6演进：
- 双协议栈

- 隧道技术
v6包进入v4网络时，封装为v4包，包离开v4网络后拆开

## 6.1 小结
不同层次工作的设备
tcp/ip参考模型
ip地址
地址转换
ip包首部
传输层主要协议
重传 流量 拥塞 三次握手
慢启动，拥塞避免
v4-v6演进

## 6.2 路由器工作原理和硬件结构

### 6.2.1 路由器基本工作过程
路由器工作在网络层

**A-R-B**

上层的数据->加首部(AB的ip和端口（服务器有熟知的）)生成报文->
加首部(A的ip，B的ip(DNS)，**不变，网络层的范围是端到端**)生成IP包->
加首部(A和路由器R左边的MAC，**一直在变，链路层的范围是同一个网络的邻居节点**)生成数据帧->
物理层（**变，上层数据变化和不同的调制编码技术**）->
R左侧网卡物理层接收->链路层解除帧封装，看目的MAC地址是不是自己->
是，链路层往上交->网络层查看目的ip:是B的，查路由表->
对应接口（右侧）链路层重新封装数据帧(R右侧的mac，B的mac(**ARP**))->
B物理、链路、网络层看是否发给自己的，是则向上交。传输层交给对应端口、应用层呈现

**路由选择算法**
- 直接转发
- 间接转发
- 默认路由，特定主机路由

# 第十五次课

# 上次课
路由选择算法
- 直接转发，最后一次转发肯定是
- 间接转发：查路由表
- 默认路由（以防意外和缩减表项），特定主机路由（管理维护）

# 6
## 6.2 路由器工作原理和硬件结构
### 6.2.2 路由选择算法及路由协议

**选路算法**
子网掩码在路由器中

1. 计算目的网络地址
2. 是否为直接路由？是则直接转发
3. 否，那是否匹配特定主机路由？是则特定主机路由
4. 否，那是否为路由表中的项？是则按表确定下一跳地址
5. 否，则按默认路由转发，没有默认路由则转发失败

Internet中使用**动态自适应、分布式、分层次**的路由协议

- 内部网关协议
  - RIP
  - OSPF
- 外部网关协议
  - BGP 4

最短路由
- 跳数多少：HOP逐跳转发
- 物理距离长短
- 时延

常用主要两种：
- 距离矢量路由算法
  - RIP
  - BGP
- 链路状态路由算法
  - OSPF

**RIP**
最早出现，使用最长
路由器内部维持一个距离适量表
周期性地和相邻路由器交换路由表信息HeartBeat
不能超过16跳：难以适应大型网络和剧烈变化的网络
p88更新过程

**OSPF**
每个节点都知道全网的拓扑结构
事件驱动更新，需要更新时才更新
广播给全网
对于规模大的网络，分为不同区域，每个区域的边界路由器ABR构成骨干区域跨区通信

### 6.2.3 路由器硬件结构
p92
一个物理接口=线卡板+接口板
第一代p96
第二代p98：多个CPU，分布式缓存
第三代p100

**ip包处理转发p105，106**
输入端口拿到ip包，根据目的地址查询路由表确定输出端口。查看ttl，优先级等。
通知主控分配共享缓存的地址，输入端口将包存在地址中
主控通知输出端口，从缓存指定位置读取ip包，发送出去

1. IP包到达路由器输入端口，提取所需首部信息。
2. 根据目的地址，查询路由表，确定该IP包的输出。同时完成转发准备工作，例如对IP包首部L字段的修改，首部校验和的重新计算等。
3. 转发引擎检查IP包首部的网络层相关信息以及传等高层信息，获取QoS和接入控制策略等，以IP包的优先级进行分类。
4. 转发引擎为该IP包分配优先级。此外，根据拥塞策略和安全策略，也有可能丢弃该IP包。
5. 转发引擎通知系统主控CPU有IP包到达。
6. 主控CPU为该IP包预留一个缓存空间。
7. 该IP包被存入共享缓存的指定位置，主控CPU通应的输出端口。如果是多播流，则通知对应的输出端口。
8. 输出端口需要根据预先指定的调度策略和该IP包先级，获取该IP包。
9. 当IP包到达输出端口，通知主控CPU。共享缓存对应空间被释放，供新的数据包使用。


### 6.2.4 多协议标记交换（MPLS）技术
（不考）

## 6.2 总结
路由器如何转发ip包
RIP，OSPF优缺点
路由器如何分类，各自代表协议

# 第七章 软交换和IMS技术

## 7.1 软交换网络技术
### 7.1.1 IP电话网技术
核心：IP电话网关
与传统电话网比较：
- 都是分级网络架构
- 编号寻址差别很大
- 信令种类更复杂

### 7.1.2 软交换
- 开放网络架构
- 业务驱动
- 统一IP协议的分组网络

**软交换**
- 狭义：软交换设备
- 广义：体系结构


# 第十六次课

# 上次内容

软交换：分解的网关功能
IMS：固定和移动网络融合

# 第七章 软交换和IMS技术
## 7.1 软交换网络技术
### 7.1.1 IP电话网技术
网关：翻译功能
ip电话网和传统电话网比较p10


### 7.1.2 软交换的概念
- 按功能划分模块
- 业务与呼叫控制分离，呼叫与承载分离。
- 使用ip协议

p19 狭义的软交换
软交换是网络演进以及分组网络的核心设备之一，它独立于传送网络，主要完成呼叫控制、资源分配、协议处理、路由、认证、计费等主要功能，同时可以向用户提供现有电路交换机所能提供的所有业务，并向第三方提供可编程能力。

### 7.1.3 软交换网络结构和协议
p21
下面为接入

**网络组成**
- 软交换设备
- 媒体网关
- 信令网关
- 业务支撑环境
- 各种终端

**软交换的协议**
媒体控制协议。H.248/MEGACO/MGCP
...

**软交换设备的功能**
p29
- 媒体网关适配
- 业务提供
- 网络管理和计费
- 地址解析和路由
- 互通
- 业务交换
- 呼叫控制功能**p30**
  - 识别用户动作：摘机、拨号
  - 呼叫处理、资源控制

**媒体网关MG**
**信令网关SG**

### 7.1.4 软交换网络的通信流程
固话和移动电话电路域核心网已经采用软交换

**软交换和PSTN网互通**
p45

## 7.2 IMS技术
IP Multimedia Subsystem
解决固定网络与移动网络融合
特点：
- 与接入无关
- 业务与控制分离
- 归属服务控制
- 用户数据和交换控制分离
- 水平体系架构

**IMS与软交换比较**
- 进一步实现呼叫控制层和业务控制层分离
- 更关注逻辑网络结构和功能
- 对移动性的支持
- 普遍认为IMS有能力融合各种网络实现下一代网络的目标。

### 7.2.2 IMS网络结构和功能实体
p62
**CSCF会话控制**
- P代理
  - 代理服务器
  - 验证请求，转发给指定目标，并处理和转发响应
- S服务
  - 注册请求
  - 控制通信过程
  - 鉴权
- I询问
  - 服务接入点
**HSS归属用户服务器**
所有与用户和服务器相关的数据

### 7.2.3IMS网络的通信流程
用户初始注册
。。。

## 7.2总结
核心思想
和软交换的不同之处
体系结构
主要设备有什么，什么功能
用户注册和典型通信流程

课后第12题
软交换基于分组交换
IMS较好地支持固定和移动网络融合

# 串讲
不同的通信网络区分
三个基本技术要素：网络结构，编号计划，计费方式
交换定义
两类信号：同步、统计
两类交换技术：电路、分组
OSI模型
无连接、面向连接
随路信令、共路信令
T接线器，S接线器
SSP，SCP
智能网，800电话
虚电路、数据报
X.25,ATM
以太网，CSMA-CD
TCP/IP
不同层的不同设备
4层结构、功能
ipv4，三类地址
子网
ip包首部：ttl，校验和，包长度
切片，重组
三次握手
差错控制（重传），流量控制（基于窗口），拥塞控制（慢启动+拥塞避免）
udp，tcp首部
路由算法
内部网关协议、外部网关协议
路由器结构，几代路由器
软交换、IMS提出原因，异同点
软交换设备功能
IMS

# 第十七次课

# 第四篇 接入与传送技术

# 第八章 传送网技术基础
## 8.1 传送网基本概念
电信网基本功能：
- 传送Transport：实现任何电信信息从一点到另一点(或另一些点)的传递
- 控制Control：实现辅助业务和操作维护功能.

- 传送，传送网：逻辑功能
- 传输Transmission，传输网：物理实现

**分层结构**

## 8.2 同步数字传送网技术
### 8.2.1 SDH传送网产生背景

SDH（同步数字体系）的产生，在其之前有PDH（准同步数字体系）
- 都基于同步时分复用
- PDH：
  - 三种标准难以国际互通，接口不规范
  - 带宽紧张，监控开销不足
  - 点到点
- SDH：
  - 统一网络节点接口，规范物理接口性能
  - 开销比特丰富，管理能力强
  - 自愈环网

**同步**
两个或多个信号之间在频率或相位上保持某种严格的特定关系（最简单的关系即频率相等）。

- PDH同步：端到端同步，独立定时，异步工作
- SDH同步：基准时钟，同步网络

**复用处理**
- PDH：逐级复用
- SDH：一步复用
**复用信息类型**

**帧同步方式**
- PDH：基于帧对准
- SDH：基于指针

**SDH，核心特征**
- 同步服用
- 强大的网络管理
- 统一的光接口和服用标准

### 8.2.2 SDH帧结构和段开销
STM-1帧结构
- 9行270列
- 段开销和管理单元打散
STM-N帧结构
9行270*N列

以字节为基础的矩形块状帧结构
由左至右、自上而下排成串行码流传输
帧重复周期125μs，每秒传输8000帧





p144 保护和恢复

